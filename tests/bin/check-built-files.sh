#!/usr/bin/env bash

if [ "$RUN_CHECK_BUILT_FILES" != 1 ]; then
	exit
fi

npm install

# ignore changes in package-lock.json
git checkout package-lock.json

# run the build script
grunt

# warn about changes in the .pot file, but don't error
if ! git diff --exit-code --quiet i18n/languages/classic-commerce.pot; then
	echo '====================================================================='
	echo '= WARNING: i18n/languages/classic-commerce.pot has changes waiting! ='
	echo '= To apply them, run: `grunt makepot:dist` and commit the results   ='
	echo '====================================================================='
	git checkout i18n/languages/classic-commerce.pot
fi

echo 'Checking autogenerated files for freshness...'
if git diff --exit-code --name-only; then
	echo 'All OK!'
else
	echo '^^^ ERROR: the above autogenerated file(s) are stale.'
	echo 'To fix this, run `grunt` and commit the resulting changes.'
	exit 1
fi
