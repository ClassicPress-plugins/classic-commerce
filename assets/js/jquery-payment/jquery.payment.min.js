jQuery(function(k){(function(){var u,a,s,t,e,n,r,i,o,l,c,h,p,f,g,v,d,m,y,C,T,w,$,D=[].slice,S=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};(k=window.jQuery||window.Zepto||window.$).payment={},k.payment.fn={},k.fn.payment=function(){var t,e;return e=arguments[0],t=2<=arguments.length?D.call(arguments,1):[],k.payment.fn[e].apply(this,t)},t=/(\d{1,4})/g,k.payment.cards=s=[{type:"maestro",patterns:[5018,502,503,506,56,58,639,6220,67],format:t,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:t,length:[16],cvcLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:t,length:[16],cvcLength:[3],luhn:!0},{type:"visa",patterns:[4],format:t,length:[13,16],cvcLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:t,length:[16],cvcLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvcLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:t,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:t,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:t,length:[16],cvcLength:[3],luhn:!0}],u=function(t){var e,n,r,a,i,o,l;for(t=(t+"").replace(/\D/g,""),r=0,i=s.length;r<i;r++)for(a=0,o=(l=(e=s[r]).patterns).length;a<o;a++)if(n=l[a]+"",t.substr(0,n.length)===n)return e},a=function(t){var e,n,r;for(n=0,r=s.length;n<r;n++)if((e=s[n]).type===t)return e},h=function(t){var e,n,r,a,i,o;for(r=!0,i=a=0,o=(n=(t+"").split("").reverse()).length;i<o;i++)e=n[i],e=parseInt(e,10),(r=!r)&&(e*=2),9<e&&(e-=9),a+=e;return a%10==0},c=function(t){var e;return null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd")||!(null==("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)?e.createRange:void 0)||!document.selection.createRange().text)},w=function(t,e){var n,r,a,i,o;try{r=e.prop("selectionStart")}catch(l){l,r=null}if(i=e.val(),e.val(t),null!==r&&e.is(":focus"))return r===i.length&&(r=t.length),i!==t&&(o=i.slice(r-1,+r+1||9e9),n=t.slice(r-1,+r+1||9e9),a=t[r],/\d/.test(a)&&o===a+" "&&n===" "+a&&(r+=1)),e.prop("selectionStart",r),e.prop("selectionEnd",r)},d=function(t){var e,n,r,a,i,o;for(null==t&&(t=""),"０１２３４５６７８９","0123456789",a="",i=0,o=(e=t.split("")).length;i<o;i++)n=e[i],-1<(r="０１２３４５６７８９".indexOf(n))&&(n="0123456789"[r]),a+=n;return a},v=function(t){var e;return e=k(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=(t=d(t)).replace(/\D/g,""),w(t,e)})},f=function(t){var e;return e=k(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=d(t),t=k.payment.formatCardNumber(t),w(t,e)})},r=function(t){var e,n,r,a,i,o,l;if(r=String.fromCharCode(t.which),/^\d+$/.test(r)&&(e=k(t.currentTarget),l=e.val(),n=u(l+r),a=(l.replace(/\D/g,"")+r).length,o=16,n&&(o=n.length[n.length.length-1]),!(o<=a||null!=e.prop("selectionStart")&&e.prop("selectionStart")!==l.length)))return(i=n&&"amex"===n.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/).test(l)?(t.preventDefault(),setTimeout(function(){return e.val(l+" "+r)})):i.test(l+r)?(t.preventDefault(),setTimeout(function(){return e.val(l+r+" ")})):void 0},e=function(t){var e,n;if(e=k(t.currentTarget),n=e.val(),8===t.which&&(null==e.prop("selectionStart")||e.prop("selectionStart")===n.length))return/\d\s$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.val(n.replace(/\d\s$/,""))})):/\s\d?$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.val(n.replace(/\d$/,""))})):void 0},g=function(t){var e;return e=k(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=d(t),t=k.payment.formatExpiry(t),w(t,e)})},i=function(t){var n,e,r;if(e=String.fromCharCode(t.which),/^\d+$/.test(e))return n=k(t.currentTarget),r=n.val()+e,/^\d$/.test(r)&&"0"!==r&&"1"!==r?(t.preventDefault(),setTimeout(function(){return n.val("0"+r+" / ")})):/^\d\d$/.test(r)?(t.preventDefault(),setTimeout(function(){var t,e;return t=parseInt(r[0],10),2<(e=parseInt(r[1],10))&&0!==t?n.val("0"+t+" / "+e):n.val(r+" / ")})):void 0},o=function(t){var e,n,r;if(n=String.fromCharCode(t.which),/^\d+$/.test(n))return r=(e=k(t.currentTarget)).val(),/^\d\d$/.test(r)?e.val(r+" / "):void 0},l=function(t){var e,n,r;if("/"===(r=String.fromCharCode(t.which))||" "===r)return n=(e=k(t.currentTarget)).val(),/^\d$/.test(n)&&"0"!==n?e.val("0"+n+" / "):void 0},n=function(t){var e,n;if(e=k(t.currentTarget),n=e.val(),8===t.which&&(null==e.prop("selectionStart")||e.prop("selectionStart")===n.length))return/\d\s\/\s$/.test(n)?(t.preventDefault(),setTimeout(function(){return e.val(n.replace(/\d\s\/\s$/,""))})):void 0},p=function(t){var e;return e=k(t.currentTarget),setTimeout(function(){var t;return t=e.val(),t=(t=d(t)).replace(/\D/g,"").slice(0,4),w(t,e)})},T=function(t){var e;return!(!t.metaKey&&!t.ctrlKey)||32!==t.which&&(0===t.which||(t.which<33||(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))))},y=function(t){var e,n,r,a;if(e=k(t.currentTarget),r=String.fromCharCode(t.which),/^\d+$/.test(r)&&!c(e))return a=(e.val()+r).replace(/\D/g,""),(n=u(a))?a.length<=n.length[n.length.length-1]:a.length<=16},C=function(t){var e,n;if(e=k(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n)&&!c(e))return!(6<(e.val()+n).replace(/\D/g,"").length)&&void 0},m=function(t){var e,n;if(e=k(t.currentTarget),n=String.fromCharCode(t.which),/^\d+$/.test(n)&&!c(e))return(e.val()+n).length<=4},$=function(t){var e,n,r,a,i;if(i=(e=k(t.currentTarget)).val(),a=k.payment.cardType(i)||"unknown",!e.hasClass(a))return n=function(){var t,e,n;for(n=[],t=0,e=s.length;t<e;t++)r=s[t],n.push(r.type);return n}(),e.removeClass("unknown"),e.removeClass(n.join(" ")),e.addClass(a),e.toggleClass("identified","unknown"!==a),e.trigger("payment.cardType",a)},k.payment.fn.formatCardCVC=function(){return this.on("keypress",T),this.on("keypress",m),this.on("paste",p),this.on("change",p),this.on("input",p),this},k.payment.fn.formatCardExpiry=function(){return this.on("keypress",T),this.on("keypress",C),this.on("keypress",i),this.on("keypress",l),this.on("keypress",o),this.on("keydown",n),this.on("change",g),this.on("input",g),this},k.payment.fn.formatCardNumber=function(){return this.on("keypress",T),this.on("keypress",y),this.on("keypress",r),this.on("keydown",e),this.on("keyup",$),this.on("paste",f),this.on("change",f),this.on("input",f),this.on("input",$),this},k.payment.fn.restrictNumeric=function(){return this.on("keypress",T),this.on("paste",v),this.on("change",v),this.on("input",v),this},k.payment.fn.cardExpiryVal=function(){return k.payment.cardExpiryVal(k(this).val())},k.payment.cardExpiryVal=function(t){var e,n,r;return e=(r=t.split(/[\s\/]+/,2))[0],2===(null!=(n=r[1])?n.length:void 0)&&/^\d+$/.test(n)&&(n=(new Date).getFullYear().toString().slice(0,2)+n),{month:e=parseInt(e,10),year:n=parseInt(n,10)}},k.payment.validateCardNumber=function(t){var e,n;return t=(t+"").replace(/\s+|-/g,""),!!/^\d+$/.test(t)&&(!!(e=u(t))&&(n=t.length,0<=S.call(e.length,n)&&(!1===e.luhn||h(t))))},k.payment.validateCardExpiry=function(t,e){var n,r,a;return"object"==typeof t&&"month"in t&&(t=(a=t).month,e=a.year),!(!t||!e)&&(t=k.trim(t),e=k.trim(e),!!/^\d+$/.test(t)&&(!!/^\d+$/.test(e)&&(1<=t&&t<=12&&(2===e.length&&(e=e<70?"20"+e:"19"+e),4===e.length&&(r=new Date(e,t),n=new Date,r.setMonth(r.getMonth()-1),r.setMonth(r.getMonth()+1,1),n<r)))))},k.payment.validateCardCVC=function(t,e){var n,r;return t=k.trim(t),!!/^\d+$/.test(t)&&(null!=(n=a(e))?(r=t.length,0<=S.call(n.cvcLength,r)):3<=t.length&&t.length<=4)},k.payment.cardType=function(t){var e;return t&&(null!=(e=u(t))?e.type:void 0)||null},k.payment.formatCardNumber=function(t){var e,n,r,a;return t=t.replace(/\D/g,""),(e=u(t))?(r=e.length[e.length.length-1],t=t.slice(0,r),e.format.global?null!=(a=t.match(e.format))?a.join(" "):void 0:null!=(n=e.format.exec(t))?(n.shift(),(n=k.grep(n,function(t){return t})).join(" ")):void 0):t},k.payment.formatExpiry=function(t){var e,n,r,a;return(n=t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/))?(e=n[1]||"",r=n[2]||"",0<(a=n[3]||"").length?r=" / ":" /"===r?(e=e.substring(0,1),r=""):2===e.length||0<r.length?r=" / ":1===e.length&&"0"!==e&&"1"!==e&&(e="0"+e,r=" / "),e+r+a):""}}).call(this)});